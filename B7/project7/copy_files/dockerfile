FROM python:alpine as builder
RUN pip install flask --user psycopg2-binary configparser
FROM alpine
COPY --from=builder /root/.local /root/.local
COPY --from=builder /usr/local/bin /usr/local/bin
COPY --from=builder /usr/local/include /usr/local/include
COPY --from=builder /usr/local/share /usr/local/share
COPY --from=builder /usr/local/lib/*.so /usr/local/lib/
COPY --from=builder /usr/local/lib/pkgconfig /usr/local/lib/pkgconfig
COPY --from=builder /usr/local/lib/python3.10/abc.py /usr/local/lib/python3.10/ast.py /usr/local/lib/python3.10/base64.py /usr/local/lib/python3.10/bisect.py /usr/local/lib/python3.10/bz2.py /usr/local/lib/python3.10/calendar.py /usr/local/lib/python3.10/codecs.py /usr/local/lib/python3.10/
COPY --from=builder /usr/local/lib/python3.10/collections/abc.py /usr/local/lib/python3.10/collections/__init__.py /usr/local/lib/python3.10/collections/
COPY --from=builder /usr/local/lib/python3.10/_collections_abc.py /usr/local/lib/python3.10/_compat_pickle.py /usr/local/lib/python3.10/_compression.py /usr/local/lib/python3.10/configparser.py /usr/local/lib/python3.10/contextlib.py /usr/local/lib/python3.10/
COPY --from=builder /usr/local/lib/python3.10/contextvars.py /usr/local/lib/python3.10/copy.py /usr/local/lib/python3.10/copyreg.py /usr/local/lib/python3.10/dataclasses.py /usr/local/lib/python3.10/datetime.py /usr/local/lib/python3.10/decimal.py /usr/local/lib/python3.10/difflib.py /usr/local/lib/python3.10/dis.py /usr/local/lib/python3.10/
COPY --from=builder /usr/local/lib/python3.10/email/base64mime.py /usr/local/lib/python3.10/email/charset.py /usr/local/lib/python3.10/email/_encoded_words.py /usr/local/lib/python3.10/email/encoders.py /usr/local/lib/python3.10/email/errors.py /usr/local/lib/python3.10/email/feedparser.py /usr/local/lib/python3.10/email/
COPY --from=builder /usr/local/lib/python3.10/email/header.py /usr/local/lib/python3.10/email/__init__.py /usr/local/lib/python3.10/email/iterators.py /usr/local/lib/python3.10/email/message.py /usr/local/lib/python3.10/email/_parseaddr.py /usr/local/lib/python3.10/email/parser.py /usr/local/lib/python3.10/email/_policybase.py /usr/local/lib/python3.10/email/quoprimime.py /usr/local/lib/python3.10/email/utils.py /usr/local/lib/python3.10/email/
COPY --from=builder /usr/local/lib/python3.10/encodings/aliases.py /usr/local/lib/python3.10/encodings/idna.py /usr/local/lib/python3.10/encodings/__init__.py /usr/local/lib/python3.10/encodings/utf_8.py /usr/local/lib/python3.10/encodings/
COPY --from=builder /usr/local/lib/python3.10/enum.py /usr/local/lib/python3.10/fnmatch.py /usr/local/lib/python3.10/functools.py /usr/local/lib/python3.10/__future__.py /usr/local/lib/python3.10/genericpath.py /usr/local/lib/python3.10/gettext.py /usr/local/lib/python3.10/hashlib.py /usr/local/lib/python3.10/heapq.py /usr/local/lib/python3.10/hmac.py /usr/local/lib/python3.10/
COPY --from=builder /usr/local/lib/python3.10/html/entities.py /usr/local/lib/python3.10/html/__init__.py /usr/local/lib/python3.10/html/
COPY --from=builder /usr/local/lib/python3.10/http/client.py /usr/local/lib/python3.10/http/cookiejar.py /usr/local/lib/python3.10/http/__init__.py /usr/local/lib/python3.10/http/server.py /usr/local/lib/python3.10/http/
COPY --from=builder /usr/local/lib/python3.10/importlib/_abc.py /usr/local/lib/python3.10/importlib/__init__.py /usr/local/lib/python3.10/importlib/machinery.py /usr/local/lib/python3.10/importlib/util.py /usr/local/lib/python3.10/importlib/
COPY --from=builder /usr/local/lib/python3.10/json/decoder.py /usr/local/lib/python3.10/json/encoder.py /usr/local/lib/python3.10/json/__init__.py /usr/local/lib/python3.10/json/scanner.py /usr/local/lib/python3.10/json/
COPY --from=builder /usr/local/lib/python3.10/lib-dynload/array.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/binascii.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_bisect.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_blake2.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_bz2.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/
COPY --from=builder /usr/local/lib/python3.10/lib-dynload/_contextvars.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_datetime.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_decimal.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/fcntl.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_hashlib.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_heapq.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/
COPY --from=builder /usr/local/lib/python3.10/lib-dynload/_json.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_lzma.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/math.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_opcode.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_pickle.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/
COPY --from=builder /usr/local/lib/python3.10/lib-dynload/_posixsubprocess.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_random.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/
COPY --from=builder /usr/local/lib/python3.10/lib-dynload/select.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_sha512.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_socket.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_ssl.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_struct.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/unicodedata.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/_uuid.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/zlib.cpython-310-x86_64-linux-gnu.so /usr/local/lib/python3.10/lib-dynload/
COPY --from=builder /usr/local/lib/python3.10/inspect.py /usr/local/lib/python3.10/io.py /usr/local/lib/python3.10/keyword.py /usr/local/lib/python3.10/linecache.py /usr/local/lib/python3.10/locale.py /usr/local/lib/python3.10/
COPY --from=builder /usr/local/lib/python3.10/logging/__init__.py /usr/local/lib/python3.10/logging/
COPY --from=builder /usr/local/lib/python3.10/lzma.py /usr/local/lib/python3.10/mimetypes.py /usr/local/lib/python3.10/ntpath.py /usr/local/lib/python3.10/numbers.py /usr/local/lib/python3.10/opcode.py /usr/local/lib/python3.10/operator.py /usr/local/lib/python3.10/os.py /usr/local/lib/python3.10/pathlib.py /usr/local/lib/python3.10/pickle.py /usr/local/lib/python3.10/pkgutil.py /usr/local/lib/python3.10/platform.py /usr/local/lib/python3.10/posixpath.py /usr/local/lib/python3.10/pprint.py /usr/local/lib/python3.10/
COPY --from=builder /usr/local/lib/python3.10/quopri.py /usr/local/lib/python3.10/random.py /usr/local/lib/python3.10/reprlib.py /usr/local/lib/python3.10/re.py /usr/local/lib/python3.10/secrets.py /usr/local/lib/python3.10/selectors.py /usr/local/lib/python3.10/shutil.py /usr/local/lib/python3.10/signal.py /usr/local/lib/python3.10/_sitebuiltins.py /usr/local/lib/python3.10/site.py /usr/local/lib/python3.10/socket.py /usr/local/lib/python3.10/socketserver.py /usr/local/lib/python3.10/sre_compile.py /usr/local/lib/python3.10/sre_constants.py /usr/local/lib/python3.10/
COPY --from=builder /usr/local/lib/python3.10/sre_parse.py /usr/local/lib/python3.10/ssl.py /usr/local/lib/python3.10/stat.py /usr/local/lib/python3.10/stringprep.py /usr/local/lib/python3.10/string.py /usr/local/lib/python3.10/struct.py /usr/local/lib/python3.10/subprocess.py /usr/local/lib/python3.10/tempfile.py /usr/local/lib/python3.10/threading.py /usr/local/lib/python3.10/tokenize.py /usr/local/lib/python3.10/token.py /usr/local/lib/python3.10/traceback.py /usr/local/lib/python3.10/types.py /usr/local/lib/python3.10/typing.py /usr/local/lib/python3.10/
COPY --from=builder /usr/local/lib/python3.10/urllib/error.py /usr/local/lib/python3.10/urllib/__init__.py /usr/local/lib/python3.10/urllib/parse.py /usr/local/lib/python3.10/urllib/request.py /usr/local/lib/python3.10/urllib/response.py /usr/local/lib/python3.10/urllib/ 
COPY --from=builder /usr/local/lib/python3.10/uuid.py /usr/local/lib/python3.10/uu.py /usr/local/lib/python3.10/warnings.py /usr/local/lib/python3.10/weakref.py /usr/local/lib/python3.10/_weakrefset.py /usr/local/lib/python3.10/
RUN ln -s  /usr/local/lib/libpython3.10.so /usr/local/lib/libpython3.10.so.1.0
WORKDIR /srv/app
ENV PATH=/root/.local:$PATH
CMD ["python3","web.py"]